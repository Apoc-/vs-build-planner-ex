<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Primary Meta Tags -->
    <title>Vampire Survivors - Build Planner</title>
    <meta name="title" content="Vampire Survivors - Build Planner" />
    <meta name="description" content="Vampire Survivors - Build Planner" />
    <link rel="icon" type="image/png" href="favicon.png" />
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://danmer.github.io/vs-build-planner" />
    <meta property="og:title" content="Vampire Survivors - Build Planner" />
    <meta property="og:description" content="Vampire Survivors - Build Planner" />
    <meta property="og:image" content="https://danmer.github.io/vs-build-planner/img/preview.jpg" />
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image" />
    <meta property="twitter:url" content="https://danmer.github.io/vs-build-planner" />
    <meta property="twitter:title" content="Vampire Survivors - Build Planner" />
    <meta property="twitter:description" content="Vampire Survivors - Build Planner" />
    <meta property="twitter:image" content="https://danmer.github.io/vs-build-planner/img/preview.jpg" />
    <!-- Styles -->
    <link rel="stylesheet" href="./assets/sprite.css" />
    <style>
      * {
        box-sizing: border-box;
      }
      html {
        font-family: 'Courier New', Courier, monospace;
        line-height: 1;
        -webkit-text-size-adjust: 100%;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
      }
      body {
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0;
        min-height: 100vh;
        background: #333 linear-gradient(-45deg, #000, #422) no-repeat;
        color: #eee;
        white-space: nowrap;
        text-align: center;
      }
      h1 {
        display: flex;
        justify-content: center;
        margin: 0 0 0.5em;
        white-space: normal;
      }
      header {
        display: flex;
        flex-direction: column;
        align-items: center;
        margin: 1em;
      }
      section {
        margin: 0.5em;
      }
      .pixels {
        image-rendering: pixelated;
      }
      .flex {
        display: flex;
      }
      .app {
        display: flex;
        flex-direction: column;
        align-items: center;
      }
      .slots {
        display: flex;
        /* border: 0.1em solid #888; */
      }
      .slot {
        position: relative;
        flex-shrink: 0;
        display: flex;
        justify-content: center;
        align-items: center;
        width: 2.5em;
        height: 2.5em;
        border: 0.05rem solid #aa9;
        background: #333 linear-gradient(-45deg, #222, #998) no-repeat;
        box-shadow: 1px 1px 5px #000;
        transition: transform 0.1s;
        font-size: 2em;
      }
      .slot:not(.character):hover {
        /* background-image: linear-gradient(-45deg, #400, #f66);
        border-color: #f99 !important; */
        background: #333 linear-gradient(-45deg, #333, #bbb) no-repeat;
        transform: scale(1.4);
        z-index: 2;
        cursor: pointer;
      }
      .slot.character {
        /* width: 20vw;
        height: 20vw; */
        width: 5em;
        height: 5em;
        border-width: 0.05rem;
      }
      .slot.arcana {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 1.667em;
        height: 1.667em;
        overflow: hidden;
      }
      .slot:nth-child(n + 7) {
        opacity: 0.5;
      }
      .slot.arcana > div {
        font-size: 0.3em;
        flex-shrink: 0;
      }
      .objects {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
      }
      .object {
        position: relative;
        margin: 0.2em;
        padding: 0.4em;
        display: flex;
        flex-direction: column;
        flex-shrink: 0;
        width: 5em;
        height: 5em;
        overflow: hidden;
        border-radius: 0.2em;
        border: 0.15em solid #aa9;
        background: #333 linear-gradient(-45deg, #222, #998) no-repeat;
        cursor: pointer;
        transition: transform 0.1s;
        box-shadow: 1px 1px 5px #000;
      }
      .object:hover {
        /* background-image: linear-gradient(-45deg, #024, #06f);
        border-color: #3cf !important; */
        border: 0.15em solid #ddc;
        background: #333 linear-gradient(-45deg, #333, #ccb) no-repeat;
        transform: scale(1.4);
        z-index: 2;
      }
      .object.selected {
        background-image: linear-gradient(-45deg, #024, #36f);
        border-color: #39f;
      }
      .green {
        background-image: linear-gradient(-45deg, #222, #3c3) !important;
      }
      .red {
        background-image: linear-gradient(-45deg, #222, #f33) !important;
      }
      .yellow {
        background-image: linear-gradient(-45deg, #222, #fc0) !important;
      }
      .green-red {
        animation: green-red 2s linear infinite;
        background-color: #3c3;
        background-image: linear-gradient(-45deg, #222, transparent) !important;
      }
      .red-green {
        animation: red-green 2s linear infinite;
        background-color: #f33;
        background-image: linear-gradient(-45deg, #222, transparent) !important;
      }
      .object.character,
      .object.passive,
      .object.weapon,
      .object.evolution,
      .object.arcana {
        align-items: flex-start;
        justify-content: flex-end;
      }
      .object.center {
        align-items: center;
        justify-content: center;
      }
      .object.stage {
        width: 12em;
      }
      .object > .title {
        position: absolute;
        top: 0.1em;
        left: 0.1em;
        font-size: 0.7em;
      }
      .object > .character {
        position: absolute;
        font-size: 1em;
      }
      .object > .arcana {
        font-size: 0.6em;
      }
      .object > .stage {
        font-size: 0.8em;
        margin-bottom: 2.8em;
      }
      .object > .passive,
      .object > .weapon,
      .object > .evolution {
        font-size: 2em;
      }
      .object > .weapons,
      .object > .evolutions {
        position: absolute;
        right: 0.2em;
        top: 0.2em;
        font-size: 0.9em;
      }
      .object > .arcana > .sprite {
        border-radius: 0.3em;
      }
      .object > .stage > .sprite {
        opacity: 0.3;
      }
      .object > .impacts {
        position: absolute;
        bottom: 0.2em;
        right: 0.2em;
      }
      .object > .items {
        display: flex;
        flex-wrap: wrap;
        align-items: flex-center;
        position: absolute;
        bottom: 0.2em;
        left: 0.2em;
      }
      .object > .items > .sprite {
        margin-right: 0.3em;
      }
      .object > .roman {
        position: absolute;
        bottom: 0.2em;
        right: 0.2em;
        padding: 0.1em 0.3em;
        background-color: #222;
        border-radius: 0.3em;
        box-shadow: 0 0 1px #000;
        font-size: 0.9em;
      }
      .object > .impacts > .impact {
        content: ' ';
        width: 0.4em;
        height: 0.4em;
        border-radius: 0.2em;
        border: 0.05em solid #333;
        background-color: #666;
      }
      .object > .impacts > .impact:hover {
        border-color: #fff;
      }
      .positive {
        background-color: #3c3 !important;
      }
      .negative {
        background-color: #f33 !important;
      }
      .hidden {
        display: none;
      }
      .empty {
        color: #999;
        font-size: 0.3em;
        font-weight: bold;
      }
      .buttons {
        display: flex;
        flex-wrap: wrap;
        align-items: center;
        justify-content: center;
        margin: 0 auto;
        font-weight: bold;
        color: #999;
        user-select: none;
      }
      .buttons.settings {
        font-size: 0.7em;
      }
      .buttons .flex .button:nth-child(n + 2) {
        margin-left: 0;
      }
      .button {
        margin: 0.5em 0.5em 0;
        cursor: pointer;
        padding: 0.3em 0.5em;
        background-color: rgba(0, 0, 0, 0.3);
        border-radius: 0.3em;
      }
      .button:hover {
        background-color: rgba(0, 0, 0, 0.5);
        color: #fff;
      }
      footer {
        margin: 1em 0;
        color: #999;
      }
      .socials {
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 0.3em;
      }
      .social {
        margin-left: 0.3em;
        opacity: 0.5;
      }
      .social:hover {
        opacity: 1;
      }
      .social img {
        width: 1em;
        height: 1em;
      }
      .author {
        color: inherit;
        text-decoration: none;
      }
      .author:hover {
        color: #ccc;
        cursor: pointer;
      }
      @media (max-width: 50em) {
        .slots {
          flex-direction: column;
          align-items: center;
        }
        .slots > .flex-1 {
          display: flex;
        }
        .slots > .flex-1 > .flex {
          flex-direction: column;
        }
        .slots > .arcanas {
          display: flex;
        }
        h1 {
          flex-direction: column;
        }
        .lg {
          display: none;
        }
        .buttons {
          max-width: 20em;
        }
      }
      @keyframes green-red {
        0% {
          background-color: #3c3;
        }
        40% {
          background-color: #f33;
        }
        80% {
          background-color: #3c3;
        }
        100% {
          background-color: #3c3;
        }
      }
      @keyframes red-green {
        0% {
          background-color: #f33;
        }
        40% {
          background-color: #3c3;
        }
        80% {
          background-color: #f33;
        }
        100% {
          background-color: #f33;
        }
      }
    </style>
  </head>
  <body>
    <div id="app">
      <main class="app" :class="{pixels: config.pixels}" :style="{fontSize: `${config.size}em`}">
        <!-- Build -->
        <header>
          <h1>
            <span>Vampire Survivors</span>
            <span class="lg">&nbsp;—&nbsp;</span>
            <span>Build Planner (0.7.2)</span>
          </h1>
          <div class="slots">
            <div class="arcanas">
              <div v-for="(arcana, $index) in selectedArcanas" :data-id="arcana.id" class="slot arcana selected" :class="arcana.type" @click="deleteItem(arcana, selectedArcanas[$index+1])" @mouseenter="showImpacts(arcana)" @mouseleave="hideImpacts()">
                <div class="sprite" :class="`sprite-${arcana.id}`" :title="arcana.name + ` (${arcana.roman})`"></div>
              </div>
              <div v-for="i in (selectedArcanas.length < 3 ? 3 - selectedArcanas.length : 0)" class="slot arcana">
                <div class="empty">ARCANA</div>
              </div>
            </div>
            <div v-if="selectedCharacter" class="character slot" :title="selectedCharacter.name" @click="deleteItem(selectedCharacter)" @mouseleave="hideImpacts()">
              <div class="sprite" :class="`sprite-${selectedCharacter.id}`"></div>
            </div>
            <div v-else class="character slot">
              <div class="empty">CHARACTER</div>
            </div>
            <div class="flex-1">
              <div class="flex">
                <div v-for="(weapon, $index) in evolvedWeapons" :data-id="weapon.id" class="slot weapon selected" :title="weapon.name" @click="deleteItem(weapon, evolvedWeapons[$index+1])" @mouseenter="showImpacts(weapon)" @mouseleave="hideImpacts()">
                  <div class="sprite" :class="`sprite-${weapon.id}`"></div>
                </div>
                <div v-for="i in (evolvedWeapons.length < 7 ? 6 - evolvedWeapons.length : 0)" class="slot weapon">
                  <div class="empty">WEAPON</div>
                </div>
              </div>
              <div class="flex">
                <div v-for="(passive, $index) in selectedPassives" :data-id="passive.id" class="slot passive selected" :title="passive.name" @click="deleteItem(passive, selectedPassives[$index+1])" @mouseenter="showImpacts(passive)" @mouseleave="hideImpacts()">
                  <div class="sprite" :class="`sprite-${passive.id}`"></div>
                </div>
                <div v-for="i in (selectedPassives.length < 7 ? 6 - selectedPassives.length : 0)" class="slot passive">
                  <div class="empty">PASSIVE</div>
                </div>
              </div>
            </div>
          </div>
          <div class="buttons">
            <div class="button" @click="reset($event)">RESET</div>
            <div class="button" @click="copyLink($event)">COPY LINK</div>
            <div class="button" @click="copyEmojis($event)">COPY EMOJIS</div>
            <div class="button" @click="copyImage($event)">COPY IMAGE</div>
            <div class="button" @click="saveImage($event)">SAVE IMAGE</div>
            <div class="button" @click="settings = !settings">SETTINGS</div>
          </div>
          <div v-if="settings" class="buttons settings">
            <div class="button" @click="config.evolutions = !config.evolutions">EVOLUTIONS: {{config.evolutions ? 'ON' : 'OFF'}}</div>
            <div class="button" @click="config.combinations = !config.combinations">COMBINATIONS: {{config.combinations ? 'ON' : 'OFF'}}</div>
            <div class="button" @click="config.impacts = !config.impacts">IMPACTS: {{config.impacts ? 'ON' : 'OFF'}}</div>
            <div class="button" @click="config.pixels = !config.pixels">PIXELS: {{config.pixels ? 'ON' : 'OFF'}}</div>
            <div class="button" @click="config.titles = !config.titles">TITLES: {{config.titles ? 'ON' : 'OFF'}}</div>
            <div class="flex">
              <div class="button" @click="config.size -= 0.1">SIZE -</div>
              <div class="button" @click="config.size += 0.1">SIZE +</div>
            </div>
          </div>
        </header>

        <!-- Characters -->
        <section style="max-width: 85em">
          <div class="objects">
            <div v-for="character in characters" :data-id="character.id" class="object character" :class="{selected: selectedCharacter.id === character.id}" @click="toggleItem(character)" @mouseenter="showImpacts(character)" @mouseleave="hideImpacts()">
              <div class="character sprite" :class="`sprite-${character.id}`" :title="character.name"></div>
              <div class="weapons">
                <div v-for="item in character.items" class="sprite" :class="`sprite-${item.id}`" :title="item.name"></div>
              </div>
              <div v-if="config.titles" class="title">{{character.id}}</div>
            </div>
          </div>
        </section>

        <!-- Weapons -->
        <section style="max-width: 75em">
          <div class="objects">
            <div v-for="weapon in weapons" :data-id="weapon.id" class="object weapon" :class="{selected: weapon.selected, center: !config.combinations && !config.titles && !config.impacts}" @click="toggleItem(weapon)" @mouseenter="showImpacts(weapon)" @mouseleave="hideImpacts()">
              <div class="weapon">
                <div class="sprite" :class="`sprite-${weapon.id}`" :title="weapon.name"></div>
              </div>
              <div v-if="config.impacts" class="impacts">
                <div v-for="impact in impactsById[weapon.id]" class="impact" :class="itemsById[impact.substring(1)].selected ? (impact[0] === '+' ? 'positive' : 'negative') : '' " :title="impact.substring(1)"></div>
              </div>
              <div v-if="config.combinations" class="evolutions">
                <div v-for="item in weapon.items" class="sprite" :class="`sprite-${item.id}`" :title="item.name"></div>
              </div>
              <div v-if="config.titles" class="title">{{weapon.id}}</div>
            </div>
          </div>
        </section>

        <!-- Evolutions -->
        <section v-if="config.evolutions" style="max-width: 55em">
          <div class="objects">
            <div v-for="evolution in evolutions" :data-id="evolution.id" class="object evolution" :class="{selected: evolution.selected, center: !config.combinations && !config.titles && !config.impacts}" @click="toggleItem(evolution)" @mouseenter="showImpacts(evolution)" @mouseleave="hideImpacts()">
              <div class="evolution">
                <div class="sprite" :class="`sprite-${evolution.id}`" :title="evolution.name"></div>
              </div>
              <div v-if="config.impacts" class="impacts">
                <div v-for="impact in impactsById[evolution.id]" class="impact" :class="itemsById[impact.substring(1)].selected ? (impact[0] === '+' ? 'positive' : 'negative') : '' " :title="impact.substring(1)"></div>
              </div>
              <div v-if="config.combinations" class="evolutions">
                <div v-for="item in evolution.items" class="sprite" :class="`sprite-${item.id}`" :title="item.name"></div>
              </div>
              <div v-if="config.titles" class="title">{{evolution.id}}</div>
            </div>
          </div>
        </section>

        <!-- Passives -->
        <section style="max-width: 60em">
          <div class="objects">
            <div v-for="passive in passives" :data-id="passive.id" class="object passive" :class="{selected: passive.selected, center: !config.combinations && !config.titles && !config.impacts}" @click="toggleItem(passive)" @mouseenter="showImpacts(passive)" @mouseleave="hideImpacts()">
              <div class="passive" :title="passive.name">
                <div class="sprite" :class="`sprite-${passive.id}`"></div>
              </div>
              <div v-if="config.impacts" class="impacts">
                <div v-for="weapon in evolvedWeapons" class="impact" :class="impactsById[weapon.id] && (impactsById[weapon.id].includes('-' + passive.id) ? 'negative' : impactsById[weapon.id].includes('+' + passive.id) ? 'positive' : 'hidden')" :title="weapon.id"></div>
                <div v-if="selectedCharacter.id" class="impact" :class="impactsById[selectedCharacter.id] && (impactsById[selectedCharacter.id].includes('-' + passive.id) ? 'negative' : impactsById[selectedCharacter.id].includes('+' + passive.id) ? 'positive' : 'hidden')" :title="selectedCharacter.id"></div>
              </div>
              <div v-if="config.combinations" class="evolutions">
                <div v-for="item in passive.items" class="sprite" :class="`sprite-${item.id}`" :title="item.name"></div>
              </div>
              <div v-if="config.titles" class="title">{{passive.id}}</div>
            </div>
          </div>
        </section>

        <!-- Arcanas -->
        <section style="max-width: 80em">
          <div class="objects">
            <div v-for="arcana in arcanas" :data-id="arcana.id" class="object arcana" :class="{selected: arcana.selected, center: !config.titles}" @click="toggleItem(arcana)" @mouseenter="showImpacts(arcana)" @mouseleave="hideImpacts()">
              <div class="arcana">
                <div class="sprite" :class="`sprite-${arcana.id}`" :title="arcana.name"></div>
              </div>
              <div v-if="config.titles" class="title">{{arcana.id}}</div>
              <div v-if="config.titles" class="roman">{{arcana.roman}}</div>
            </div>
          </div>
        </section>

        <!-- Stages -->
        <section style="max-width: 65em">
          <div class="objects">
            <div v-for="stage in stages" :data-id="stage.id" class="object stage center" :class="{selected: stage.selected}" @click="toggleItem(stage)" @mouseenter="showImpacts(stage)" @mouseleave="hideImpacts()">
              <div class="stage">
                <div class="sprite" :class="`sprite-${stage.id}`" :title="stage.name"></div>
              </div>
              <div class="items">
                <div v-for="item in stage.items.slice(0, -4)" class="sprite" :class="`sprite-${item.id}`" :title="item.name"></div>
                <div style="width: 100%"></div>
                <div v-for="item in stage.items.slice(-4)" class="sprite" :class="`sprite-${item.id}`" :title="item.name"></div>
              </div>
              <div v-if="config.titles" class="title">{{stage.id}}</div>
            </div>
          </div>
        </section>

        <!-- Footer -->
        <footer>
          <small class="socials">
            <span>Vampire Survivors:</span>
            <a class="social" href="https://store.steampowered.com/app/1794680/Vampire_Survivors/" target="_blank"><img src="./img/steam.svg" alt="" /></a>
            <a class="social" href="https://twitter.com/poncle_vampire" target="_blank"><img src="./img/twitter.svg" alt="" /></a>
            <a class="social" href="https://www.instagram.com/vampire_survivors/" target="_blank"><img src="./img/instagram.svg" alt="" /></a>
            <a class="social" href="https://www.tiktok.com/@vampire_survivors" target="_blank"><img src="./img/tiktok.svg" alt="" /></a>
            <a class="social" href="https://discord.com/invite/vampire-survivors" target="_blank"><img src="./img/discord.svg" alt="" /></a>
            <a class="social" href="https://www.reddit.com/r/VampireSurvivors/" target="_blank"><img src="./img/reddit.svg" alt="" /></a>
          </small>
          <small>Website is made by <a class="author" href="mailto:danmer.ekb@gmail.com">Danmer</a>, 2022</small>
        </footer>
      </main>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/3.2.32/vue.global.prod.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dom-to-image/2.6.0/dom-to-image.min.js"></script>
    <script>
      const { createApp, ref, reactive, computed, watch, watchEffect, nextTick } = Vue

      createApp({
        setup() {
          const config = useConfig()

          const settings = ref(false)

          const selectedIds = reactive(new Set(location.hash.length > 1 ? location.hash.substring(1).split(',') : []))

          const characters = reactive([
            { id: 'antonio', name: 'Antonio', emoji: ':charAntonioVS:', itemIds: ['whip'] },
            { id: 'imelda', name: 'Imelda', emoji: ':charImeldaVS:', itemIds: ['magicwand'] },
            { id: 'pasqualina', name: 'Pasqualina', emoji: ':charPasqualinaVS:', itemIds: ['runetracer'] },
            { id: 'gennaro', name: 'Gennaro', emoji: ':charGennaroVS:', itemIds: ['knife'] },
            { id: 'arca', name: 'Arca', emoji: ':charArcaVS:', itemIds: ['firewand'] },
            { id: 'porta', name: 'Porta', emoji: ':charPortaVS:', itemIds: ['lightning'] },
            { id: 'lama', name: 'Lama', emoji: ':charLamaVS:', itemIds: ['axe'] },
            { id: 'poe', name: 'Poe', emoji: ':charPoeVS:', itemIds: ['garlic'] },
            { id: 'clerici', name: 'Clerici', emoji: ':charClericiVS:', itemIds: ['water'] },
            { id: 'dommario', name: 'Dommario', emoji: ':charDommarioVS:', itemIds: ['bible'] },
            { id: 'krochi', name: 'Krochi', emoji: ':charKrochiVS:', itemIds: ['cross'] },
            { id: 'christine', name: 'Christine', emoji: ':charChristineVS:', itemIds: ['pentagram'] },
            { id: 'pugnala', name: 'Pugnala', emoji: ':charPugnalaVS:', itemIds: ['guns1', 'guns2'] },
            { id: 'poppea', name: 'Poppea', emoji: ':charPoppeaVS:', itemIds: ['mana'] },
            { id: 'mortaccio', name: 'Mortaccio', emoji: ':charMortaccioVS:', itemIds: ['bone'] },
            { id: 'cavallo', name: 'Cavallo', emoji: ':charYattacavalloVS:', itemIds: ['cherry'] },
            { id: 'ramba', name: 'Ramba', emoji: ':charBiancaVS:', itemIds: ['cart'] },
            { id: 'giovanna', name: 'Giovanna', emoji: ':charGiovannaVS:', itemIds: ['cat'] },
            { id: 'osole', name: 'O`Sole', emoji: ':charOsolemeeo2VS:', itemIds: ['flowers'] },
            { id: 'concetta', name: 'Concetta', emoji: ':charConcettaVS:', itemIds: ['pinion'] },
            { id: 'gallo', name: 'Gallo', emoji: ':charIguanaVS:', itemIds: ['lancet'] },
            { id: 'divano', name: 'Divano', emoji: ':charDivanoVS:', itemIds: ['laurel'] },
            { id: 'assunta', name: 'Zi`Assunta', emoji: ':question:', itemIds: ['vento'] },
            { id: 'exdash', name: 'Exdash', emoji: ':charExdashVS:', itemIds: ['bird2'], secret: true },
            { id: 'toastie', name: 'Toastie', emoji: ':charToastieVS:', itemIds: ['bird1'], secret: true },
            { id: 'smith', name: 'Smith IV', emoji: ':question:', itemIds: ['bird_'], secret: true },
            { id: 'marrabbio', name: 'Marrabbio', emoji: ':charBoonVS:', itemIds: ['knife_'], secret: true },
            { id: 'minnah', name: 'Minnah', emoji: ':question:', itemIds: ['whip_'], secret: true },
            { id: 'leda', name: 'Leda', emoji: ':charLedaVS:', itemIds: ['magicwand_'], secret: true },
            { id: 'reaper', name: 'Red Death', emoji: ':charReddeathVS:', itemIds: ['axe_'], secret: true },
          ])

          const weapons = reactive([
            { id: 'magicwand', name: 'Magic Wand', emoji: ':magicwandVS:' },
            { id: 'firewand', name: 'Fire Wand', emoji: ':firewandVS:' },
            { id: 'axe', name: 'Axe', emoji: ':axeVS:' },
            { id: 'lightning', name: 'Lightning Ring', emoji: ':lightningringVS:' },
            { id: 'knife', name: 'Knife', emoji: ':knifeVS:' },
            { id: 'bible', name: 'King Bible', emoji: ':kingbibleVS:' },
            { id: 'cross', name: 'Cross', emoji: ':crossVS:' },
            { id: 'garlic', name: 'Garlic', emoji: ':garlicVS:' },
            { id: 'pentagram', name: 'Pentagram', emoji: ':pentagramVS:' },
            { id: 'runetracer', name: 'Runetracer', emoji: ':runetracerVS:' },
            { id: 'water', name: 'Santa Water', emoji: ':santawaterVS:' },
            { id: 'mana', name: 'Song Of Mana', emoji: ':manaVS:' },
            { id: 'whip', name: 'Whip', emoji: ':whipVS:' },
            { id: 'guns1', name: 'Phiera Der Tuphello', emoji: ':phieraVS:' },
            { id: 'guns2', name: 'Eight The Sparrow', emoji: ':sparrowVS:' },
            { id: 'bird1', name: 'Peachone', emoji: ':peachoneVS:' },
            { id: 'bird2', name: 'Ebony Wings', emoji: ':ebonywingsVS:' },
            { id: 'vento', name: 'Vento Sacro', emoji: ':question:' },
            { id: 'lancet', name: 'Clock Lancet', emoji: ':lancetVS:' },
            { id: 'laurel', name: 'Laurel', emoji: ':laurelVS:' },
            { id: 'bone', name: 'Bone', emoji: ':boneVS:' },
            { id: 'cherry', name: 'Cherry Bomb', emoji: ':cherrybombVS:' },
            { id: 'cart', name: 'Carréllo', emoji: ':carrelloVS:' },
            { id: 'flowers', name: 'Celestial Dusting', emoji: ':celestialdustingVS:' },
            { id: 'cat', name: 'Gatti Amari', emoji: ':catVS:' },
            { id: 'pinion', name: 'Shadow Pinion', emoji: ':shadowpinionVS:' },
          ])

          const evolutions = reactive([
            { id: 'magicwand_', name: 'Holy Wand', emoji: ':holywandVS:', itemIds: ['magicwand', 'cooldown'] },
            { id: 'firewand_', name: 'Hellfire', emoji: ':hellfireVS:', itemIds: ['firewand', 'might'] },
            { id: 'axe_', name: 'Death Spiral', emoji: ':deathspiralVS:', itemIds: ['axe', 'area'] },
            { id: 'lightning_', name: 'Thunder Loop', emoji: ':thunderloopVS:', itemIds: ['lightning', 'amount'] },
            { id: 'knife_', name: 'Thousand Edge', emoji: ':thousandedgeVS:', itemIds: ['knife', 'speed'] },
            { id: 'bible_', name: 'Unholy Vespers', emoji: ':unholyvespersVS:', itemIds: ['bible', 'duration'] },
            { id: 'cross_', name: 'Heaven Sword', emoji: ':heavenswordVS:', itemIds: ['cross', 'luck'] },
            { id: 'garlic_', name: 'Soul Eater', emoji: ':souleaterVS:', itemIds: ['garlic', 'recovery'] },
            { id: 'pentagram_', name: 'Gorgeous Moon', emoji: ':gorgeousmoonVS:', itemIds: ['pentagram', 'growth'] },
            { id: 'runetracer_', name: 'NO FUTURE', emoji: ':NOFUTUREVS:', itemIds: ['runetracer', 'armor'] },
            { id: 'water_', name: 'La Borra', emoji: ':laborraVS:', itemIds: ['water', 'magnet'] },
            { id: 'mana_', name: 'Mannajja', emoji: ':mannajjaVS:', itemIds: ['mana', 'curse'] },
            { id: 'whip_', name: 'Bloody Tear', emoji: ':bloodytearVS:', itemIds: ['whip', 'health'] },
            { id: 'guns_', name: 'Phieraggi', emoji: ':phieraggiVS:', itemIds: ['guns1', 'guns2', 'revival'] },
            { id: 'bird_', name: 'Vandalier', emoji: ':vandalierVS:', itemIds: ['bird1', 'bird2'] },
            { id: 'cat_', name: 'Vicious Hunger', emoji: ':cateyeVS:', itemIds: ['cat', 'greed'] },
            { id: 'pinion_', name: 'Valkyrie Turner', emoji: ':valkyrieVS:', itemIds: ['pinion', 'wings'] },
            { id: 'vento_', name: 'Fuwalafuwaloo', emoji: ':question:', itemIds: ['vento', 'whip_'] },
            { id: 'lancet_', name: 'Infinite Corridor', emoji: ':portalVS:', itemIds: ['lancet', 'ring1', 'ring2'] },
            { id: 'laurel_', name: 'Crimson Shroud', emoji: ':cloakVS:', itemIds: ['laurel', 'sign1', 'sign2'] },
          ])

          const passives = reactive([
            { id: 'cooldown', name: 'Empty Tome', emoji: ':emptytomeVS:' },
            { id: 'might', name: 'Spinach', emoji: ':spinachVS:' },
            { id: 'area', name: 'Candelabrador', emoji: ':candelabradorVS:' },
            { id: 'amount', name: 'Duplicator', emoji: ':duplicatorVS:' },
            { id: 'speed', name: 'Bracer', emoji: ':bracerVS:' },
            { id: 'duration', name: 'Spellbinder', emoji: ':spellbinderVS:' },
            { id: 'luck', name: 'Clover', emoji: ':cloverVS:' },
            { id: 'recovery', name: 'Pummarola', emoji: ':pummarolaVS:' },
            { id: 'growth', name: 'Crown', emoji: ':crownVS:' },
            { id: 'armor', name: 'Armor', emoji: ':armorVS:' },
            { id: 'magnet', name: 'Attractorb', emoji: ':attractorbVS:' },
            { id: 'curse', name: 'Skull O`Maniac', emoji: ':curseVS:' },
            { id: 'health', name: 'Hollow Heart', emoji: ':hollowheartVS:' },
            { id: 'revival', name: 'Tiragisú', emoji: ':tiragisuVS:' },
            { id: 'wings', name: 'Wings', emoji: ':wingsVS:' },
            { id: 'greed', name: 'Stone Mask', emoji: ':maskVS:' },
            { id: 'torrona', name: 'Torrona`s Box', emoji: ':question:' },
            { id: 'ring1', name: 'Gold Ring', emoji: ':goldringVS:', special: true },
            { id: 'ring2', name: 'Silver Ring', emoji: ':silverringVS:', special: true },
            { id: 'sign1', name: 'Metaglio Left', emoji: ':metaglioleftVS:', special: true },
            { id: 'sign2', name: 'Metaglio Right', emoji: ':metagliorightVS:', special: true },
          ])

          const arcanas = reactive([
            { id: 'arcana4', name: 'Awake', emoji: ':4VS:' },
            { id: 'arcana5', name: 'Chaos in the Dark Night', emoji: ':5VS:' },
            { id: 'arcana6', name: 'Sarabande of Healing', emoji: ':6VS:' },
            { id: 'arcana7', name: 'Iron Blue Will', emoji: ':7VS:' },
            { id: 'arcana8', name: 'Mad Groove', emoji: ':question:' },
            { id: 'arcana10', name: 'Beginning', emoji: ':question:' },
            { id: 'arcana11', name: 'Waltz of Pearls', emoji: ':11VS:' },
            { id: 'arcana12', name: 'Out of Bounds', emoji: ':XIIoutofbounds:' },
            { id: 'arcana14', name: 'Jail of Crystal', emoji: ':XIVjailofcrystal:' },
            { id: 'arcana15', name: 'Disco of Gold', emoji: ':XIVdiscoofgold:' },
            { id: 'arcana16', name: 'Slash', emoji: ':16VS:' },
            { id: 'arcana17', name: 'Lost & Found Painting', emoji: ':17VS:' },
            { id: 'arcana18', name: 'Boogaloo of Illusions', emoji: ':XVIIIboogaloofillusions:' },
            { id: 'arcana19', name: 'Heart of Fire', emoji: ':19VS:' },
          ])

          const stages = reactive([
            { id: 'forest', name: 'Mad Forest', itemIds: ['might', 'luck', 'health', 'recovery', 'curse'] },
            { id: 'library', name: 'Inlaid Library', itemIds: ['cooldown', 'greed'] },
            { id: 'plant', name: 'Dairy Plant', itemIds: ['magnet', 'area', 'wings', 'armor'] },
            { id: 'tower', name: 'Gallo Tower', itemIds: ['speed', 'duration'] },
            { id: 'capella', name: 'Cappella Magna', itemIds: ['growth', 'revival', 'amount'] },
          ])

          // List of all objects
          const items = [...characters, ...weapons, ...passives, ...evolutions, ...arcanas, ...stages]
          const itemsById = items.reduce((itemsById, item) => Object.assign(itemsById, { [item.id]: item }), {})

          keyById(items)

          // Extra fields
          for (const character of characters) {
            character.type = 'character'
          }
          for (const weapon of weapons) {
            weapon.type = 'weapon'
          }
          for (const passive of passives) {
            passive.type = 'passive'
          }
          for (const evolution of evolutions) {
            evolution.type = 'evolution'
            evolution.weaponIds = evolution.itemIds.filter((itemId) => itemsById[itemId].type === 'weapon')
            evolution.evolutionIds = evolution.itemIds.filter((itemId) => itemsById[itemId].type === 'evolution')
            evolution.passiveIds = evolution.itemIds.filter((itemId) => itemsById[itemId].type === 'passive')
            for (const itemId of evolution.itemIds) {
              itemsById[itemId].evolutionId = evolution.id
              itemsById[itemId].itemIds = itemsById[itemId].itemIds || evolution.itemIds.filter((id) => id !== itemId)
            }
            // find level 2 evolutions containing the same items
            const evolution2 = evolutions.find((evo) => evo.itemIds.includes(evolution.id))
            if (evolution2) {
              for (const itemId of evolution2.itemIds) {
                evolution.evolutionId = evolution2.id
              }
            }
          }
          for (const arcana of arcanas) {
            arcana.type = 'arcana'
            arcana.roman = toRoman(+arcana.id.substring(6))
          }
          for (const stage of stages) {
            stage.type = 'stage'
            stage.itemIds.push('ring1', 'ring2', 'sign1', 'sign2')
          }
          for (const item of items) {
            item.items = item.itemIds ? item.itemIds.map((itemId) => itemsById[itemId]) : []
            item.evolution = item.evolutionId && itemsById[item.evolutionId]
          }

          const impactsById = computed(() => {
            const newImpactsById = {
              antonio: ['+armor', '+health', '+might'],
              imelda: ['+growth'],
              pasqualina: ['+speed'],
              gennaro: ['+health', '+amount'],
              arca: ['+cooldown'],
              porta: ['+area'],
              lama: ['+health', '+wings', '+might', '+curse'],
              poe: ['+magnet', '-health'],
              clerici: ['+health', '+recovery'],
              dommario: ['+speed', '+duration', '-wings'],
              krochi: ['+revival', '+wings'],
              christine: ['+cooldown', '+wings', '-might', '-health'],
              pugnala: ['+wings', '+might'],
              poppea: ['+wings', '+duration'],
              mortaccio: ['+amount'],
              cavallo: ['+amount'],
              ramba: ['+amount'],
              giovanna: ['+wings', '+speed'],
              osole: ['+amount'],
              concetta: ['+wings', '+curse', '+area'],
              gallo: ['+growth', '+duration', '+cooldown', '-greed'],
              divano: ['+armor', '+recovery', '+luck', '-greed'],
              assunta: ['+might', '+speed', '+duration', '+area'],
              exdash: ['+luck', '-health', '-wings', '-might', '-area', '-speed', '-duration', '-cooldown'],
              toastie: ['+wings', '+luck', '-health', '-might', '-area', '-speed', '-duration', '-cooldown'],
              smith: ['+wings', '+luck', '-cooldown', '-might', '-area', '-speed', '-duration'],
              marrabbio: ['+health', '+might', '+wings', '+curse', '-speed', '-greed'],
              minnah: ['+health', '+luck', '+recovery', '-might', '~duration', '~area', '~cooldown', '!might', '!speed'],
              reaper: ['+health', '+wings', '+might'],
              leda: ['+armor', '+might', '+area', '+cooldown', '-wings', '-greed'],
              arcana4: ['+revival', '+health', '+armor', '+might', '+area', '+duration', '+speed'],
              arcana5: ['~speed'],
              arcana6: ['+recovery', '+whip_', '+garlic_', '+revival', '+flowers'],
              arcana7: ['+knife', '+knife_', '+axe', '+axe_', '+guns1', '+guns2', '+cart'],
              arcana8: [],
              arcana10: ['+amount'],
              arcana11: ['+magicwand', '+magicwand_', '+firewand', '+firewand_', '+cross', '+cross_', '+cart'],
              arcana12: ['+lancet'],
              arcana14: ['+magicwand', '+magicwand_', '+runetracer', '+runetracer_', '+guns2'],
              arcana15: ['+cat_', '+greed'],
              arcana16: ['+knife', '+knife_', '+whip', '+whip_', '+axe', '+axe_', '+cross_'],
              arcana17: ['~duration'],
              arcana18: ['~area'],
              arcana19: ['+firewand', '+firewand_', '+guns1', '+pinion_'],
              axe: ['+cooldown', '+might', '+area', '+amount', '+speed'],
              axe_: ['+cooldown', '+might', '+area', '+amount', '+speed'],
              bible: ['+cooldown', '+might', '+area', '+amount', '+speed', '+duration'],
              bible_: ['+cooldown', '+might', '+area', '+amount', '+speed', '+duration'],
              bird1: ['+cooldown', '+might', '+area', '+amount', '+speed', '+duration', '+wings'],
              bird_: ['+cooldown', '+might', '+area', '+amount', '+speed', '+duration', '+wings'],
              bird2: ['+cooldown', '+might', '+area', '+amount', '+speed', '+duration', '+wings'],
              bone: ['+cooldown', '+might', '+area', '+amount', '+speed', '+duration'],
              cart: ['+cooldown', '+might', '+area', '+amount', '+speed'],
              cat: ['+cooldown', '+might', '+area', '+amount', '+speed', '+duration', '+luck'],
              cat_: ['+cooldown', '+might', '+area', '+amount', '+speed', '+duration', '+luck'],
              cherry: ['+cooldown', '+might', '+area', '+amount', '+speed', '+duration', '+luck'],
              cross: ['+cooldown', '+might', '+area', '+amount', '+speed'],
              cross_: ['+cooldown', '+might', '+area', '+amount', '+speed', '+luck'],
              firewand: ['+cooldown', '+might', '+area', '+amount', '+speed'],
              firewand_: ['+cooldown', '+might', '+area', '+amount', '+speed'],
              flowers: ['+cooldown', '+might', '+area', '+amount', '+duration', '+speed', '+wings'],
              garlic: ['+cooldown', '+might', '+area'],
              garlic_: ['+cooldown', '+might', '+area', '+recovery'],
              guns1: ['+cooldown', '+might', '+area', '+amount', '+speed', '+luck'],
              guns_: ['+cooldown', '+might', '+area', '+amount', '+speed', '+luck', '+revival'],
              guns2: ['+cooldown', '+might', '+area', '+amount', '+speed', '+luck'],
              knife: ['+cooldown', '+might', '+area', '+amount', '+speed'],
              knife_: ['+cooldown', '+might', '+area', '+amount', '+speed', '+luck'],
              lancet: ['+cooldown', '+duration'],
              laurel: ['+cooldown'],
              lancet_: ['+cooldown', '+duration'],
              laurel_: ['+cooldown', '+area', '+might', '+armor'],
              lightning: ['+cooldown', '+might', '+area', '+amount'],
              lightning_: ['+cooldown', '+might', '+area', '+amount'],
              magicwand: ['+cooldown', '+might', '+area', '+amount', '+speed'],
              magicwand_: ['+cooldown', '+might', '+area', '+amount', '+speed'],
              mana: ['+cooldown', '+might', '+area', '+duration'],
              mana_: ['+cooldown', '+might', '+area', '+duration'],
              pentagram: ['+cooldown', '+luck'],
              pentagram_: ['+cooldown'],
              pinion: ['+cooldown', '+might', '+area', '+duration', '+amount'],
              pinion_: ['+cooldown', '+might', '+area', '+duration', '+amount', '+wings'],
              runetracer: ['+cooldown', '+might', '+area', '+amount', '+speed', '+duration'],
              runetracer_: ['+cooldown', '+might', '+area', '+amount', '+speed', '+duration'],
              vento: ['+cooldown', '+might', '+area', '+speed', '+amount', '+luck', '+speed'],
              vento_: ['+cooldown', '+might', '+area', '+speed', '+amount', '+luck', '+speed'],
              water: ['+cooldown', '+might', '+area', '+amount', '+duration'],
              water_: ['+cooldown', '+might', '+area', '+amount', '+speed', '+duration', '+wings'],
              whip: ['+cooldown', '+might', '+area', '+amount'],
              whip_: ['+cooldown', '+might', '+area', '+amount', '+luck'],
              torrona: ['+might', '+speed', '+duration', '+area', '+curse'],
              ring1: ['+curse'],
              ring2: ['+duration', '+area'],
              sign1: ['+curse'],
              sign2: ['+recovery', '+health'],
            }

            for (const itemId in newImpactsById) {
              const impactIds = newImpactsById[itemId]
              const item = itemsById[itemId]
              // add dynamic impacts with conditions
              if ((item.type === 'weapon' || item.type === 'evolution') && (impactIds.includes('+area') || impactIds.includes('+duration'))) {
                impactIds.push('+ring2')
              }
              if ((item.type === 'weapon' || item.type === 'evolution') && (impactIds.includes('+recovery') || impactIds.includes('+health'))) {
                impactIds.push('+sign2')
              }
              if ((item.type === 'weapon' || item.type === 'evolution') && (impactIds.includes('+might') || impactIds.includes('+speed') || impactIds.includes('+duration') || impactIds.includes('+area'))) {
                impactIds.push('+torrona')
              }
              if (selectedIds.has('arcana16') && ['axe', 'axe_', 'knife', 'whip', 'whip_'].includes(itemId)) {
                impactIds.push('+luck')
              }
              // add weapon impacts to passive
              for (const impactId of impactIds) {
                const id = impactId.substring(1)
                const newImpactId = impactId[0] + itemId
                newImpactsById[id] = newImpactsById[id] || []
                if (!newImpactsById[id].includes(newImpactId)) {
                  newImpactsById[id].push(newImpactId)
                }
              }
            }

            // sort impacts (selected - down, others - up)
            for (const itemId in newImpactsById) {
              newImpactsById[itemId].sort((id1, id2) => (selectedIds.has(id1.substring(1)) && !selectedIds.has(id2.substring(1)) ? 1 : -1))
            }

            return newImpactsById
          })

          const selectedItems = computed(() => Array.from(selectedIds).map((itemId) => itemsById[itemId]))
          const selectedCharacter = computed(() => selectedItems.value.find((item) => item.type === 'character') || { id: '', emoji: '', itemIds: [], items: [] })
          const selectedWeapons = computed(() => selectedItems.value.filter((item) => item.type === 'weapon').sort((a, b) => (a.fixed && !b.fixed ? -1 : 0)))
          const selectedPassives = computed(() => selectedItems.value.filter((item) => item.type === 'passive'))
          const selectedArcanas = computed(() => selectedItems.value.filter((item) => item.type === 'arcana'))
          const evolvedWeapons = computed(() => Array.from(new Set(selectedWeapons.value.map((weapon) => (weapon.evolved ? (weapon.evolution.evolved ? weapon.evolution.evolution : weapon.evolution) : weapon)))))

          watch(
            selectedIds,
            () => {
              const idsArray = Array.from(selectedIds)
              for (const item of items) {
                item.selected = idsArray.includes(item.id)
              }
              for (const evolution of evolutions) {
                evolution.selected = evolution.items.every((it) => it.selected) || selectedCharacter.value.itemIds.includes(evolution.id)
              }
              for (const weapon of weapons) {
                // fix character's weapon to make it first and prevent it from deleting
                weapon.fixed = selectedCharacter.value.itemIds.includes(weapon.id) || selectedCharacter.value.itemIds.includes(weapon.evolutionId)
                // evolved if all required items are selected
                weapon.evolved = weapon.evolutionId && (weapon.evolution.items.every((it) => it.selected) || selectedCharacter.value.itemIds.includes(weapon.evolutionId))
              }
              for (const evolution of evolutions) {
                // evolved if all required items are selected or evolved
                evolution.evolved = evolution.evolutionId && (evolution.evolution.items.every((it) => it.selected) || selectedCharacter.value.itemIds.includes(evolution.evolutionId))
              }
              updateHash()
            },
            { immediate: true }
          )

          watch(
            selectedCharacter,
            (newCharacter, oldCharacter) => {
              // delete items of the previous character
              if (oldCharacter) {
                for (const itemId of oldCharacter.itemIds) {
                  unselectetId(itemId)
                }
              }
              // add items of the new character
              for (const itemId of newCharacter.itemIds) {
                selectId(itemId)
              }
            },
            { immediate: true }
          )

          window.config = config
          window.itemsById = itemsById

          window.addEventListener('hashchange', updateSelectedIds)

          function updateSelectedIds() {
            selectedIds.clear()
            for (const id of location.hash.substring(1).split(',')) {
              if (id) {
                selectedIds.add(id)
              }
            }
          }

          function updateHash() {
            const newHash = (selectedCharacter.value.id ? [selectedCharacter.value] : [])
              .concat(selectedWeapons.value, selectedPassives.value, selectedArcanas.value)
              .map((item) => item.id)
              .join()
            if ('#' + newHash !== location.hash) {
              location.hash = newHash
            }
          }

          function showImpacts(object) {
            if (!object) {
              return
            }
            if (object.itemIds) {
              for (const itemId of object.itemIds.concat(object.evolutionId)) {
                document.querySelectorAll(`[data-id="${itemId}"]`).forEach((element) => {
                  element.classList.add('yellow')
                })
              }
            }
            if (impactsById.value[object.id]) {
              for (const impact of impactsById.value[object.id]) {
                document.querySelectorAll(`[data-id="${impact.substring(1)}"]`).forEach((element) => {
                  element.classList.add(impact[0] === '+' ? 'green' : impact[0] === '-' ? 'red' : impact[0] === '~' ? 'green-red' : impact[0] === '!' ? 'red-green' : 0)
                })
              }
            }
          }

          function hideImpacts() {
            document.querySelectorAll(`.yellow, .green, .red, .green-red, .red-green`).forEach((element) => {
              element.classList.remove('yellow', 'green', 'red', 'green-red', 'red-green')
            })
          }

          function unselectetId(itemId) {
            const item = itemsById[itemId]
            if (item.type === 'evolution') {
              for (const weaponId of item.weaponIds.concat(item.evolutionIds)) {
                unselectetId(weaponId)
              }
            } else {
              if (!item.fixed) {
                selectedIds.delete(item.id)
              }
            }
          }

          function selectId(itemId) {
            const item = itemsById[itemId]
            switch (item.type) {
              case 'character':
                if (selectedCharacter.value.id) {
                  selectedIds.delete(selectedCharacter.value.id)
                }
                selectedIds.add(item.id)
                break
              case 'evolution':
                const itemids = selectedCharacter.value.itemIds.includes(item.id) ? item.weaponIds : item.itemIds
                for (const itemId of itemids) {
                  selectId(itemId)
                }
                break
              case 'arcana':
                if (selectedArcanas.value.length < 3) {
                  selectedIds.add(item.id)
                }
                break
              case 'stage':
                for (const itemId of item.itemIds) {
                  selectId(itemId)
                }
                break
              default:
                selectedIds.add(item.id)
            }
          }

          // manual toggle
          function toggleItem(item) {
            if (item.selected) {
              unselectetId(item.id)
            } else {
              selectId(item.id)
              nextTick(() => {
                showImpacts(item)
              })
            }
          }

          // manual delete
          function deleteItem(item, nextItem) {
            unselectetId(item.id)
            if (nextItem) {
              hideImpacts()
              showImpacts(nextItem)
            } else {
              hideImpacts()
            }
          }

          function reset(event) {
            selectedIds.clear()
            highlightElement(event.target, '#3c3')
          }

          function saveImage(event) {
            domtoimage
              .toPng(document.querySelector('.slots'))
              .then((dataUrl) => {
                var link = document.createElement('a')
                link.download = `vs-build_${new Date().toISOString().substring(0, 19).replaceAll(':', '-')}.png`
                link.href = dataUrl
                link.click()
                highlightElement(event.target, '#3c3')
              })
              .catch(() => highlightElement(event.target, '#c33'))
          }

          function copyImage(event) {
            domtoimage.toBlob(document.querySelector('.slots')).then((dataBlob) => {
              navigator.clipboard
                .write([new ClipboardItem({ 'image/png': dataBlob })])
                .then(() => highlightElement(event.target, '#3c3'))
                .catch(() => highlightElement(event.target, '#c33'))
            })
          }

          function copyLink(event) {
            const text = location.href
            navigator.clipboard
              .writeText(text)
              .then(() => highlightElement(event.target, '#3c3'))
              .catch(() => highlightElement(event.target, '#c33'))
          }

          function copyEmojis(event) {
            let text = `Build: <${location.href}>`
            if (selectedCharacter.value.id || selectedArcanas.value.length) {
              text += `\n${selectedCharacter.value.emoji}${selectedCharacter.value.emoji ? ' ' : ''}${selectedArcanas.value.map((item) => item.emoji).join(' ')}`
            }
            if (evolvedWeapons.value.length) {
              text += `\n${evolvedWeapons.value.map((item) => item.emoji).join(' ')}`
            }
            if (selectedPassives.value.length) {
              text += `\n${selectedPassives.value.map((item) => item.emoji).join(' ')}`
            }
            navigator.clipboard
              .writeText(text)
              .then(() => highlightElement(event.target, '#3c3'))
              .catch(() => highlightElement(event.target, '#c33'))
          }

          function keyById(items) {
            return items.reduce((object, item) => {
              object[item.id] = item
              return object
            }, {})
          }

          function toRoman(number) {
            const roman = { X: 10, IX: 9, V: 5, IV: 4, I: 1 }
            let result = ''
            for (let i of Object.keys(roman)) {
              let q = Math.floor(number / roman[i])
              number -= q * roman[i]
              result += i.repeat(q)
            }
            return result
          }

          function highlightElement(target, color = '#3c3') {
            if (target) {
              target.style.color = color
              setTimeout(() => {
                target.style.color = ''
              }, 200)
            }
          }

          function useConfig(storageKey = 'vs-build') {
            const defaultConfig = { impacts: true, pixels: true, titles: true, evolutions: false, combinations: true, size: 1, version: 2 }

            const userConfig = loadUserConfig()

            if (userConfig.version !== defaultConfig.version) {
              Object.assign(userConfig, defaultConfig)
            }

            const config = reactive({ ...defaultConfig, ...(userConfig.version === defaultConfig.version ? userConfig : {}) })

            watch(config, saveUserConfig)

            function loadUserConfig() {
              return JSON.parse(localStorage.getItem(storageKey) || '{}')
            }

            function saveUserConfig() {
              for (const param in config) {
                if (config[param] === defaultConfig[param] && param !== 'version') {
                  delete userConfig[param]
                } else {
                  userConfig[param] = config[param]
                }
              }
              localStorage.setItem(storageKey, JSON.stringify(userConfig))
            }

            return config
          }

          return {
            config,
            settings,
            characters,
            weapons,
            passives,
            evolutions,
            arcanas,
            stages,
            itemsById,
            impactsById,
            selectedCharacter,
            selectedWeapons,
            selectedPassives,
            selectedArcanas,
            evolvedWeapons,
            showImpacts,
            hideImpacts,
            toggleItem,
            deleteItem,
            saveImage,
            copyImage,
            copyLink,
            copyEmojis,
            reset,
          }
        },
      }).mount('#app')
    </script>

    <!-- Yandex.Metrika counter -->
    <script type="text/javascript">
      ;(function (m, e, t, r, i, k, a) {
        m[i] =
          m[i] ||
          function () {
            ;(m[i].a = m[i].a || []).push(arguments)
          }
        m[i].l = 1 * new Date()
        ;(k = e.createElement(t)), (a = e.getElementsByTagName(t)[0]), (k.async = 1), (k.src = r), a.parentNode.insertBefore(k, a)
      })(window, document, 'script', 'https://mc.yandex.ru/metrika/tag.js', 'ym')
      ym(88260279, 'init', { clickmap: true, trackLinks: true, accurateTrackBounce: true, webvisor: true, trackHash: true })
    </script>
    <noscript>
      <div><img src="https://mc.yandex.ru/watch/88260279" style="position: absolute; left: -9999px" alt="" /></div>
    </noscript>
    <!-- /Yandex.Metrika counter -->
  </body>
</html>
